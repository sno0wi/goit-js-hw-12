{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport axios from \"axios\";\n\nconst form = document.querySelector('.form');\nconst loadMoreBtn = document.querySelector('.load_more');\nconst lightbox = new SimpleLightbox('.gallery a');\nconst loader = document.querySelector('.loader')\n\naxios.defaults.baseURL = 'https://pixabay.com/api';\n\nlet page = 1;\nlet perPage = 100;\nlet currentQuery = '';\n\nasync function searchImages(imageName) {\n    const apiKey = '41833958-d4e1402628473c9a9cbd6bb32';\n\n    const params = new URLSearchParams({\n    key: apiKey,\n    q: imageName.toLowerCase(),\n    per_page: perPage,\n    page: page,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n});\n    \n    loader.style.display = 'block';\n    \n    const response = await axios.get(`/?${params}`);\n            if (response.status !== 200){\n                    throw new Error(\"No images found. Please try again with a different search query.\");\n            }\n\n    return response.data;\n}\n\n\nfunction renderGallery(images, append = false) {\n    const gallery = document.querySelector('.gallery');\n\n    if (!append) {\n            gallery.innerHTML = '';\n        }\n\n    if (images.hits.length === 0) {\n        iziToast.error({\n            message: \"No images found. Please try again with a different search query.\",\n        });\n        return;\n    }\n\n    const imageHTML = images.hits.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => `\n        <li class=\"gallery-item\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n                <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n            </a>\n            <div class=\"image-details\">\n                <p>Likes </br> ${likes}</p>\n                <p>Views </br>  ${views}</p>\n                <p>Comments </br>  ${comments}</p>\n                <p>Downloads </br>  ${downloads}</p>\n            </div>\n        </li>`\n    ).join('');\n\n    gallery.innerHTML += imageHTML;\n    lightbox.refresh();\n\n    if (!append) {\n        loadMoreBtn.style.display = 'block';\n    }\n    \n    loader.style.display = 'none';\n    loadMoreBtn.style.display = 'block';\n}\n\nasync function handleSearch(event) {\n    event.preventDefault();\n\n    loadMoreBtn.style.display = 'none';\n\n    const formElement = event.currentTarget;\n    const query = formElement.elements.query.value;\n    currentQuery = query;\n\n    if (!query) {\n        iziToast.warning({\n            message: \"Please enter a search query.\",\n        });\n        return;\n    }\n\n    page = 1;\n\n    try {\n        const images = await searchImages(currentQuery);\n        renderGallery(images);\n    } catch (error) {\n        iziToast.error({\n            message: error.message,\n        });\n    } finally {\n        formElement.reset();\n    }\n}\n\nasync function getImages(query) {\n    try {\n        const images = await searchImages(query);\n        return images;\n    } catch (error) {\n        iziToast.error({\n            message: \"Error load new images.\"\n        });\n    }\n}\n\nasync function loadMore() {\n    try {\n        const images = await getImages(currentQuery);\n        const totalPages = Math.ceil(images.totalHits / perPage);\n        if (page > totalPages) {\n            iziToast.error({\n                message: \"We're sorry, but you've reached the end of search results.\"\n            });\n            loadMoreBtn.style.display = 'none';\n            return;\n        }\n\n        page ++;\n        renderGallery(images, true);\n        \n        const galleryItemHeight = getGalleryItemHeight();\n        window.scrollBy({\n            top: galleryItemHeight * 2,\n            behavior: 'smooth',\n        });\n    } catch (error) {\n        iziToast.error({\n            message: \"Error load new images.\"\n        });\n    }\n    loader.style.display = 'none';\n}\n\nasync function handleLoadMore() {\n    loader.style.display = 'block';\n\n    if (!currentQuery) {\n        iziToast.warning({\n            message: \"Please enter a search query.\",\n        });\n        return;\n    }\n\n    try {\n        await loadMore();\n    } catch (error) {\n        console.error('Error during handling \"Load More\":', error);\n        throw new Error(\"Error during handling 'Load More'.\");\n    }\n}\n\nform.addEventListener('submit', handleSearch);\nloadMoreBtn.addEventListener('click', handleLoadMore);\n\nfunction getGalleryItemHeight(){\n    const galleryItem = document.querySelector('.gallery-item');\n\n    if (galleryItem) {\n        const rect = galleryItem.getBoundingClientRect();\n        return rect.height;\n    }\n    return 0;\n}"],"names":["form","loadMoreBtn","lightbox","SimpleLightbox","loader","axios","page","perPage","currentQuery","searchImages","imageName","apiKey","params","response","renderGallery","images","append","gallery","iziToast","imageHTML","webformatURL","largeImageURL","tags","likes","views","comments","downloads","handleSearch","event","formElement","query","error","getImages","loadMore","totalPages","galleryItemHeight","getGalleryItemHeight","handleLoadMore","galleryItem"],"mappings":"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"}
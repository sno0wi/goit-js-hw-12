{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport axios from \"axios\";\n\nconst form = document.querySelector('.form');\nconst loadMoreBtn = document.querySelector('.load_more');\nconst lightbox = new SimpleLightbox('.gallery a');\nconst loader = document.querySelector('.loader')\n\naxios.defaults.baseURL = 'https://pixabay.com/api';\n\nlet page = 1;\nlet perPage = 40;\nlet currentQuery = '';\n\nasync function searchImages(imageName) {\n    const apiKey = '41833958-d4e1402628473c9a9cbd6bb32';\n\n    const params = new URLSearchParams({\n    key: apiKey,\n    q: imageName.toLowerCase(),\n    per_page: perPage,\n    page: page,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n});\n    loader.classList.add('visible');\n    \n    const response = await axios.get(`/?${params}`);\n            if (response.status !== 200){\n                iziToast.error({\n                    message: \"No images found. Please try again with a different search query.\"\n                });\n            }\n\n    return response.data;\n}\n\n\nfunction renderGallery(images, append = false) {\n    const gallery = document.querySelector('.gallery');\n\n    if (!append) {\n            gallery.innerHTML = '';\n        }\n\n    if (images.hits.length === 0) {\n        iziToast.error({\n            message: \"No images found. Please try again with a different search query.\"\n        });\n        return;\n    }\n\n    const imageHTML = images.hits.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => `\n        <li class=\"gallery-item\">\n            <a class=\"gallery-link\" href=\"${largeImageURL}\">\n                <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n            </a>\n            <div class=\"image-details\">\n                <p>Likes </br> ${likes}</p>\n                <p>Views </br>  ${views}</p>\n                <p>Comments </br>  ${comments}</p>\n                <p>Downloads </br>  ${downloads}</p>\n            </div>\n        </li>`\n    ).join('');\n\n    gallery.innerHTML += imageHTML;\n    lightbox.refresh();\n\n    if (!append) {\n        loadMoreBtn.classList.add('visible');\n    }\n    \n    // loader.classList.remove('visible');\n    setTimeout(() => {\n        loader.classList.remove('visible');\n    }, 50);\n}\n\nasync function handleSearch(event) {\n    event.preventDefault();\n\n    loadMoreBtn.classList.remove('visible');\n\n    const formElement = event.currentTarget;\n    const query = formElement.elements.query.value;\n    currentQuery = query;\n\n    if (!query) {\n        iziToast.warning({\n            message: \"Please enter a search query.\",\n        });\n        return;\n    }\n\n    page = 1;\n\n    try {\n        const images = await searchImages(currentQuery);\n        renderGallery(images);\n    } catch (error) {\n        iziToast.error({\n            message: error.message,\n        });\n    } finally {\n        formElement.reset();\n    }\n}\n\nasync function getImages(query) {\n    page++;\n    \n    try {\n        const images = await searchImages(query);\n        return images;\n    } catch (error) {\n        iziToast.error({\n            message: \"Error load new images.\"\n        });\n    }\n}\n\nasync function loadMore() {\n    try {\n        const images = await getImages(currentQuery);\n        const totalPages = Math.ceil(images.totalHits / perPage);\n        if (page >= totalPages) {\n            iziToast.error({\n                message: \"We're sorry, but you've reached the end of search results.\"\n            });\n            // loader.classList.remove('visible');\n            setTimeout(() => {\n                loader.classList.remove('visible');\n            }, 500);\n            loadMoreBtn.classList.remove('visible');\n        }\n\n        renderGallery(images, true);\n        \n        const galleryItemHeight = getGalleryItemHeight();\n        window.scrollBy({\n            top: galleryItemHeight * 2,\n            behavior: 'smooth',\n        });\n    } catch (error) {\n        iziToast.error({\n            message: \"Error load new images.\"\n        });\n    } finally {\n        // loader.classList.remove('visible');\n        setTimeout(() => {\n            loader.classList.remove('visible');\n        }, 500);\n    }\n}\n\nasync function handleLoadMore() {\n    loader.classList.add('visible');\n\n    if (!currentQuery) {\n        iziToast.warning({\n            message: \"Please enter a search query.\",\n        });\n        return;\n    }\n\n    try {\n        await loadMore();\n    } catch (error) {\n        iziToast.error({\n            message: \"Error during handling 'Load More'.\"\n        });\n    }\n}\n\nform.addEventListener('submit', handleSearch);\nloadMoreBtn.addEventListener('click', handleLoadMore);\n\nfunction getGalleryItemHeight(){\n    const galleryItem = document.querySelector('.gallery-item');\n\n    if (galleryItem) {\n        const rect = galleryItem.getBoundingClientRect();\n        return rect.height;\n    }\n    return 0;\n}"],"names":["form","loadMoreBtn","lightbox","SimpleLightbox","loader","axios","page","perPage","currentQuery","searchImages","imageName","apiKey","params","response","iziToast","renderGallery","images","append","gallery","imageHTML","webformatURL","largeImageURL","tags","likes","views","comments","downloads","handleSearch","event","formElement","query","error","getImages","loadMore","totalPages","galleryItemHeight","getGalleryItemHeight","handleLoadMore","galleryItem"],"mappings":"+vBAMA,MAAMA,EAAO,SAAS,cAAc,OAAO,EACrCC,EAAc,SAAS,cAAc,YAAY,EACjDC,EAAW,IAAIC,EAAe,YAAY,EAC1CC,EAAS,SAAS,cAAc,SAAS,EAE/CC,EAAM,SAAS,QAAU,0BAEzB,IAAIC,EAAO,EACPC,EAAU,GACVC,EAAe,GAEnB,eAAeC,EAAaC,EAAW,CACnC,MAAMC,EAAS,qCAETC,EAAS,IAAI,gBAAgB,CACnC,IAAKD,EACL,EAAGD,EAAU,YAAa,EAC1B,SAAUH,EACV,KAAMD,EACN,WAAY,QACZ,YAAa,aACb,WAAY,EAChB,CAAC,EACGF,EAAO,UAAU,IAAI,SAAS,EAE9B,MAAMS,EAAW,MAAMR,EAAM,IAAI,KAAKO,CAAM,EAAE,EACtC,OAAIC,EAAS,SAAW,KACpBC,EAAS,MAAM,CACX,QAAS,kEAC7B,CAAiB,EAGND,EAAS,IACpB,CAGA,SAASE,EAAcC,EAAQC,EAAS,GAAO,CAC3C,MAAMC,EAAU,SAAS,cAAc,UAAU,EAMjD,GAJKD,IACGC,EAAQ,UAAY,IAGxBF,EAAO,KAAK,SAAW,EAAG,CAC1BF,EAAS,MAAM,CACX,QAAS,kEACrB,CAAS,EACD,MACH,CAED,MAAMK,EAAYH,EAAO,KAAK,IAAI,CAAC,CAAE,aAAAI,EAAc,cAAAC,EAAe,KAAAC,EAAM,MAAAC,EAAO,MAAAC,EAAO,SAAAC,EAAU,UAAAC,CAAW,IAAK;AAAA;AAAA,4CAExEL,CAAa;AAAA,kDACPD,CAAY,UAAUE,CAAI;AAAA;AAAA;AAAA,iCAG3CC,CAAK;AAAA,kCACJC,CAAK;AAAA,qCACFC,CAAQ;AAAA,sCACPC,CAAS;AAAA;AAAA,cAG/C,EAAM,KAAK,EAAE,EAETR,EAAQ,WAAaC,EACrBjB,EAAS,QAAO,EAEXe,GACDhB,EAAY,UAAU,IAAI,SAAS,EAIvC,WAAW,IAAM,CACbG,EAAO,UAAU,OAAO,SAAS,CACpC,EAAE,EAAE,CACT,CAEA,eAAeuB,EAAaC,EAAO,CAC/BA,EAAM,eAAc,EAEpB3B,EAAY,UAAU,OAAO,SAAS,EAEtC,MAAM4B,EAAcD,EAAM,cACpBE,EAAQD,EAAY,SAAS,MAAM,MAGzC,GAFArB,EAAesB,EAEX,CAACA,EAAO,CACRhB,EAAS,QAAQ,CACb,QAAS,8BACrB,CAAS,EACD,MACH,CAEDR,EAAO,EAEP,GAAI,CACA,MAAMU,EAAS,MAAMP,EAAaD,CAAY,EAC9CO,EAAcC,CAAM,CACvB,OAAQe,EAAO,CACZjB,EAAS,MAAM,CACX,QAASiB,EAAM,OAC3B,CAAS,CACT,QAAc,CACNF,EAAY,MAAK,CACpB,CACL,CAEA,eAAeG,EAAUF,EAAO,CAC5BxB,IAEA,GAAI,CAEA,OADe,MAAMG,EAAaqB,CAAK,CAE1C,MAAe,CACZhB,EAAS,MAAM,CACX,QAAS,wBACrB,CAAS,CACJ,CACL,CAEA,eAAemB,GAAW,CACtB,GAAI,CACA,MAAMjB,EAAS,MAAMgB,EAAUxB,CAAY,EACrC0B,EAAa,KAAK,KAAKlB,EAAO,UAAYT,CAAO,EACnDD,GAAQ4B,IACRpB,EAAS,MAAM,CACX,QAAS,4DACzB,CAAa,EAED,WAAW,IAAM,CACbV,EAAO,UAAU,OAAO,SAAS,CACpC,EAAE,GAAG,EACNH,EAAY,UAAU,OAAO,SAAS,GAG1Cc,EAAcC,EAAQ,EAAI,EAE1B,MAAMmB,EAAoBC,IAC1B,OAAO,SAAS,CACZ,IAAKD,EAAoB,EACzB,SAAU,QACtB,CAAS,CACJ,MAAe,CACZrB,EAAS,MAAM,CACX,QAAS,wBACrB,CAAS,CACT,QAAc,CAEN,WAAW,IAAM,CACbV,EAAO,UAAU,OAAO,SAAS,CACpC,EAAE,GAAG,CACT,CACL,CAEA,eAAeiC,GAAiB,CAG5B,GAFAjC,EAAO,UAAU,IAAI,SAAS,EAE1B,CAACI,EAAc,CACfM,EAAS,QAAQ,CACb,QAAS,8BACrB,CAAS,EACD,MACH,CAED,GAAI,CACA,MAAMmB,EAAQ,CACjB,MAAe,CACZnB,EAAS,MAAM,CACX,QAAS,oCACrB,CAAS,CACJ,CACL,CAEAd,EAAK,iBAAiB,SAAU2B,CAAY,EAC5C1B,EAAY,iBAAiB,QAASoC,CAAc,EAEpD,SAASD,GAAsB,CAC3B,MAAME,EAAc,SAAS,cAAc,eAAe,EAE1D,OAAIA,EACaA,EAAY,wBACb,OAET,CACX"}